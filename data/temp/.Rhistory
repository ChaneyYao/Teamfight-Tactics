library(httr)
library(jsonlite)
library(dplyr)
library(ggplot2)
library(tidyverse)
# Scraping data
url <- "https://api-hc.metatft.com/tft-comps-api/unit_items_processed"
res <- GET(url)
data <- fromJSON(content(res, as = "text", encoding = "UTF-8"))
# Flattening the data frame
units_df = as_tibble(data$units)
View(units_df)
View(units_df)
final_df <- units_df %>%
# 1. We name the elements in the nested list so the new columns have names
mutate(items = map(items, ~ setNames(.x[[1]], paste0("item_", 1:nrow(.x))))) %>%
# 2. Flatten the list into 10 distinct columns
unnest_wider(items)
View(units_df)
units_df = as_tibble(data$units %>% t())
View(units_df)
units_df = data$units
View(units_df)
# Flattening the data frame
units_df = as.tibble(data$units)
units_df = as_tibble(data$units)
?as_tibble
str(units_df)
# Flattening the data frame
units_df = as_tibble(data$units)
str(units_df)
class(units_df)
summary(units_df)
# 1. Turn the columns into a list, then into a long tibble
tidy_units <- units %>%
# Row 1 is a duplicate of the column names; we can drop it later or use it as IDs
t() %>%
as.data.frame() %>%
rownames_to_column(var = "unit_id") %>%
as_tibble()
source("C:/Teamfight-Tactics/Teamfight-Tactics/data/temp/IS-units-record.R", echo=TRUE)
source("C:/Teamfight-Tactics/Teamfight-Tactics/data/temp/IS-units-record.R", echo=TRUE)
source("C:/Teamfight-Tactics/Teamfight-Tactics/data/temp/IS-units-record.R", echo=TRUE)
source("C:/Teamfight-Tactics/Teamfight-Tactics/data/temp/IS-units-record.R", echo=TRUE)
View(units_tidy)
# A simple named vector
player_scores <- c(Alice = 95, Bob = 82, Charlie = 91)
enframe(player_scores, name = "player", value = "score")
# A list containing different types of data
my_list <- list(
A = c(1, 2, 3),
B = "Hello",
C = data.frame(x = 1:2)
)
View(my_list)
enframe(my_list)
View(units_tidy)
View(units_df)
unit_list = data$units
View(unit_list)
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
)
# 2. Transpose and Rectangle with Robust Error Handling
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
) %>%
# 3. Explode the items list into 10 separate columns
unnest_wider(items) %>%
select(-details)
# 2. Transpose and Rectangle with Robust Error Handling
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
) %>%
# 3. Explode the items list into 10 separate columns
unnest_wider(items) %>%
filter(!is.na(item_1))
select(-details)
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
) %>%
# 3. Explode the items list into 10 separate columns
unnest_wider(items) %>%
filter(!is.na(item_1)) %>%
select(-details)
units_tidy$unit
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
) %>%
# 3. Explode the items list into 10 separate columns
unnest_wider(items) %>%
filter(!is.na(item_1)) %>%
select(-details) %>%
# Only TFT16
filter(str_detect(unit_id, "^TFT16"))
# 2. Transpose and Rectangle with Robust Error Handling
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
) %>%
# 3. Explode the items list into 10 separate columns
unnest_wider(items) %>%
filter(!is.na(item_1)) %>%
select(-details) %>%
# Only TFT16
filter(str_detect(unit, "^TFT16"))
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
) %>%
# 3. Explode the items list into 10 separate columns
unnest_wider(items) %>%
filter(!is.na(item_1)) %>%
select(-details) %>%
# Only TFT16
filter(str_detect(unit, "^TFT16")) %>%
mutate(unit = str_remove(unit, "TFT_16"))
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
) %>%
# 3. Explode the items list into 10 separate columns
unnest_wider(items) %>%
filter(!is.na(item_1)) %>%
select(-details) %>%
# Only TFT16
filter(str_detect(unit, "^TFT16")) %>%
mutate(unit = str_remove(unit, "TFT_16"))
# 2. Transpose and Rectangle with Robust Error Handling
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
) %>%
# 3. Explode the items list into 10 separate columns
unnest_wider(items) %>%
filter(!is.na(item_1)) %>%
select(-details) %>%
# Only TFT16
filter(str_detect(unit, "^TFT16")) %>%
mutate(unit_name = str_remove(unit, "TFT_16"))
# 2. Transpose and Rectangle with Robust Error Handling
units_tidy <- enframe(unit_list, name = "unit", value = "details") %>%
mutate(
# Pulling rows safely
count = map_dbl(details, ~ as.numeric(.x[[2]])),
place = map_dbl(details, ~ as.numeric(.x[[3]])),
average = map_dbl(details, ~ as.numeric(.x[[4]])),
pick = map_dbl(details, ~ as.numeric(.x[[5]])),
# Robust item handling
items = map(details, function(df_list) {
# Safety first: check if index 6 exists and is a dataframe
item_df <- df_list[[6]]
# The Fix: Handle NA/NULL/Empty values properly
if (!is.data.frame(item_df) || nrow(item_df) == 0) {
# Return a named vector of 10 NAs so the columns align
return(setNames(as.list(rep(NA, 10)), paste0("item_", 1:10)))
}
# Convert the 10x1 dataframe column to a named list for unnest_wider
setNames(as.list(item_df[[1]]), paste0("item_", seq_len(nrow(item_df))))
})
) %>%
# 3. Explode the items list into 10 separate columns
unnest_wider(items) %>%
filter(!is.na(item_1)) %>%
select(-details) %>%
# Only TFT16
filter(str_detect(unit, "^TFT16")) %>%
mutate(unit = str_remove(unit, "TFT16_"))
?write_csv
# 1. Define the Patch Version
patch_version <- "16.3"
# 2. Generate the timestamp in your specified format (YYYY-MM-DD-HHMM)
# %H%M will give you the 24-hour time format like 2048
current_time <- format(Sys.time(), "%Y-%m-%d-%H%M")
# 3. Combine into the final filename
file_name <- paste0(patch_version, "-", current_time, "-units.csv")
# 4. Save the data frame
write_csv(units_tidy, file_name)
saving_route = "C:/Teamfight-Tactics/Teamfight-Tactics/data/processed"
# 4. Save the data frame
write_csv(units_tidy, file_name, path = saving_route)
# 4. Save the data frame
write_csv(units_tidy, file_name, file = saving_route)
saving_route = "C:/Teamfight-Tactics/Teamfight-Tactics/data/processed/"
# 4. Save the data frame
write_csv(units_tidy, file_name, file = saving_route)
saving_route = "C:/Teamfight-Tactics/Teamfight-Tactics/data/processed/"
# 4. Save the data frame
write_csv(units_tidy, file_name, file = saving_route)
# 1. Define the Patch Version
patch_version <- "16.3"
# 2. Generate the timestamp in your specified format (YYYY-MM-DD-HHMM)
# %H%M will give you the 24-hour time format like 2048
current_time <- format(Sys.time(), "%Y-%m-%d-%H%M")
# Define your path and dynamic filename
saving_route <- "C:/Teamfight-Tactics/Teamfight-Tactics/data/processed/"
patch_version <- "16.3"
current_time <- format(Sys.time(), "%Y-%m-%d-%H%M")
file_name <- paste0(patch_version, "-", current_time, "-units.csv")
# 1. Combine them into a full path
full_path <- file.path(saving_route, file_name)
# 2. Save the data frame
write_csv(units_tidy, full_path)
source = "C:/Teamfight-Tactics/Teamfight-Tactics/data/processed/16.3-2026-01-24-2101-units.csv"
rm(list = ls())
library(httr)
library(jsonlite)
library(dplyr)
library(ggplot2)
library(tidyverse)
source = "C:/Teamfight-Tactics/Teamfight-Tactics/data/processed/16.3-2026-01-24-2101-units.csv"
data = read.csv(source)
View(data)
ggplot(data, aes(x = average)) +
geom_histogram(binwidth = 0.15, fill = "skyblue", color = "black") +
geom_vline(xintercept = lower_bound, color = "red") +
geom_vline(xintercept = upper_bound, color = "red") +
geom_vline(xintercept = x_bar, color = "black") +
labs(
x = "Average Place",
y = "count",
title = "Average Place of Units"
)
ggplot(data, aes(x = average)) +
geom_histogram(binwidth = 0.15, fill = "skyblue", color = "black") +
geom_vline(xintercept = x_bar, color = "black") +
labs(
x = "Average Place",
y = "count",
title = "Average Place of Units"
)
ggplot(data, aes(x = average)) +
geom_histogram(binwidth = 0.15, fill = "skyblue", color = "black") +
labs(
x = "Average Place",
y = "count",
title = "Average Place of Units"
)
ggplot(data, aes(x = pick, y = average_place)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red") +
geom_text(aes(label = unit), hjust = -0.1, vjust = -0.5, size = 2.5)
ggplot(data, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red") +
geom_text(aes(label = unit), hjust = -0.1, vjust = -0.5, size = 2.5)
# 1. Define the Patch Version
patch_version <- "16.3"
# 2. Generate the timestamp in your specified format (YYYY-MM-DD-HHMM)
# %H%M will give you the 24-hour time format like 2048
current_time <- format(Sys.time(), "%Y-%m-%d-%H%M")
# Define your path and dynamic filename
saving_route <- "C:/Teamfight-Tactics/Teamfight-Tactics/data/processed/plots/"
patch_version <- "16.3"
file_name <- paste0(patch_version, "-", current_time, "-units.png")
?ggsave
ggsave(filename, plot = get_last_plot(), path = saving_route)
ggsave(file_name, plot = get_last_plot(), path = saving_route)
ggplot(units_tidy, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red", linetype = "dashed") +
geom_text(aes(label = unit_name), hjust = -0.1, vjust = -0.5, size = 2.5) +
# Adjust these numbers to "crop" the plot to your cluster
coord_cartesian(xlim = c(0.1, 0.5), ylim = c(3.5, 5.5))
ggplot(data, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red", linetype = "dashed") +
geom_text(aes(label = unit_name), hjust = -0.1, vjust = -0.5, size = 2.5) +
# Adjust these numbers to "crop" the plot to your cluster
coord_cartesian(xlim = c(0.1, 0.5), ylim = c(3.5, 5.5))
ggplot(data, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red", linetype = "dashed") +
geom_text(aes(label = unit), hjust = -0.1, vjust = -0.5, size = 2.5) +
# Adjust these numbers to "crop" the plot to your cluster
coord_cartesian(xlim = c(0.1, 0.5), ylim = c(3.5, 5.5))
ggplot(data, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red", linetype = "dashed") +
geom_text(aes(label = unit), hjust = -0.1, vjust = -0.5, size = 2.5) +
# Adjust these numbers to "crop" the plot to your cluster
coord_cartesian(xlim = c(-0.1, 0.5), ylim = c(3.5, 5.5))
ggplot(data, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red", linetype = "dashed") +
geom_text(aes(label = unit), hjust = -0.1, vjust = -0.5, size = 2.5) +
# Adjust these numbers to "crop" the plot to your cluster
coord_cartesian(xlim = c(0, 0.5), ylim = c(3.5, 5.5))
ggplot(data, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red", linetype = "dashed") +
geom_text(aes(label = unit), hjust = -0.1, vjust = -0.5, size = 2.5) +
# Adjust these numbers to "crop" the plot to your cluster
coord_cartesian(xlim = c(0.05, 0.5), ylim = c(3.5, 5.5))
ggplot(data, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red", linetype = "dashed") +
geom_text(aes(label = unit), hjust = -0.1, vjust = -0.5, size = 2.5) +
# Adjust these numbers to "crop" the plot to your cluster
coord_cartesian(xlim = c(0.01, 0.5), ylim = c(3.5, 5.5))
ggplot(data, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red", linetype = "dashed") +
geom_text(aes(label = unit), hjust = -0.1, vjust = -0.5, size = 2.5) +
# Adjust these numbers to "crop" the plot to your cluster
coord_cartesian(xlim = c(0.01, 0.5), ylim = c(3.6, 5.4))
ggplot(data, aes(x = pick, y = average)) +
geom_point() +
geom_hline(yintercept = 4.5, color = "red", linetype = "dashed") +
geom_text(aes(label = unit), hjust = -0.1, vjust = -0.5, size = 2.5) +
# Adjust these numbers to "crop" the plot to your cluster
coord_cartesian(xlim = c(0.01, 0.5), ylim = c(3.6, 5.4)) +
scale_y_reverse() # Units with average 3.0 will be at the top, 6.0 at the bottom
source("C:/Teamfight-Tactics/Teamfight-Tactics/data/temp/IS-units-record.R", echo=TRUE)
source("C:/Teamfight-Tactics/Teamfight-Tactics/finding/16.3-20260124-unitdata-overview.R", echo=TRUE)
